<!doctype html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Lucky Staff Portal</title>
<link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css rel=stylesheet>
<link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css rel=stylesheet>
<script src=https://cdn.jsdelivr.net/npm/sweetalert2@11></script>
<style>:root{--primary:#2563eb;--dark:#0f172a;--success:#22c55e;--warning:#eab308;--danger:#ef4444}body{background-color:#f1f5f9;font-family:'Segoe UI',sans-serif;height:100vh;overflow:hidden}#login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#1e293b 0,#0f172a 100%);display:flex;align-items:center;justify-content:center;z-index:9999}.login-card{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);padding:30px;border-radius:20px;border:1px solid rgba(255,255,255,.1);width:85%;max-width:350px;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,.5)}.login-input{background:rgba(0,0,0,.3);border:none;color:#fff;padding:12px;border-radius:10px;margin-bottom:15px;width:100%;text-align:center}.login-input:focus{outline:1px solid var(--primary);background:rgba(0,0,0,.5);color:#fff}.btn-login{background:var(--primary);border:none;padding:12px;width:100%;border-radius:10px;font-weight:700;color:#fff;margin-top:10px}#app-screen{display:none;height:100%;flex-direction:column}.app-header{background:var(--dark);color:#fff;padding:15px 20px;border-bottom-left-radius:25px;border-bottom-right-radius:25px;flex-shrink:0;position:relative}.status-dot{height:12px;width:12px;background-color:var(--warning);border-radius:50%;display:inline-block;margin-left:8px;box-shadow:0 0 5px var(--warning);transition:.3s}.status-online{background-color:var(--success);box-shadow:0 0 8px var(--success)}.status-offline{background-color:var(--danger);box-shadow:0 0 8px var(--danger)}.search-box{background:#fff;border-radius:25px;padding:10px 20px;margin-top:15px;display:flex;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,.1)}.search-box input{border:none;outline:0;width:100%;margin-left:10px}.content-area{flex-grow:1;overflow-y:auto;padding:20px;padding-bottom:80px}.stock-card{background:#fff;border-radius:16px;padding:15px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,.05);border:1px solid #e2e8f0;opacity:0;transform:translateY(20px);transition:.4s ease-out}.stock-card.visible{opacity:1;transform:translateY(0)}.shop-badge{font-size:.75rem;padding:4px 8px;border-radius:6px;font-weight:600;text-transform:uppercase}.bg-shop1{background:#dbeafe;color:#1e40af}.bg-shop2{background:#fce7f3;color:#9d174d}.bg-shop3{background:#d1fae5;color:#065f46}.action-btns{display:flex;gap:8px;margin-top:12px}.btn-act{flex:1;padding:8px;border-radius:8px;border:none;font-size:.9rem;font-weight:600}.btn-transfer{background:#fff7ed;color:#c2410c;border:1px solid #ffedd5}.btn-sell{background:#f0fdf4;color:#15803d;border:1px solid #dcfce7}.skeleton{height:100px;background:#e2e8f0;border-radius:16px;margin-bottom:15px;animation:pulse 1.5s infinite}@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}</style>
</head>
<body>
<div id=login-screen>
<div class="login-card text-center">
<div class=mb-3><i class="fas fa-mobile-alt fa-3x text-warning"></i></div>
<h4 class=fw-bold>Lucky Telecom</h4>
<p class="small text-white-50">Staff Login</p>
<form id=loginForm>
<input id=loginId class=login-input placeholder="Username (Case Sensitive)" required autocomplete=off>
<input type=password id=loginPass class=login-input placeholder=Password required>
<button type=submit class=btn-login>ENTER SHOP <i class="fas fa-arrow-right"></i></button>
</form>
</div>
</div>
<div id=app-screen>
<div class=app-header>
<div class="d-flex justify-content-between align-items-center">
<div>
<h5 class="m-0 fw-bold d-flex align-items-center">
Stock List <span id=connStatus class=status-dot title="Live Status"></span>
</h5>
<small class=text-white-50>User: <span id=displayUser class="text-warning fw-bold"></span></small>
</div>
<button class="btn btn-sm btn-outline-light rounded-circle" onclick=logout()><i class="fas fa-sign-out-alt"></i></button>
</div>
<div class=search-box>
<i class="fas fa-search text-secondary"></i>
<input id=searchInput placeholder="Search mobile, model..." onkeyup=filterStock()>
</div>
<div class="d-flex gap-2 mt-3 overflow-auto no-scrollbar">
<button class="btn btn-sm btn-light rounded-pill px-3 active-filter" onclick='filterShop("all",this)'>All</button>
<button class="btn btn-sm btn-outline-light rounded-pill px-3" onclick='filterShop("shop1",this)'>Main</button>
<button class="btn btn-sm btn-outline-light rounded-pill px-3" onclick='filterShop("shop2",this)'>Shop 2</button>
<button class="btn btn-sm btn-outline-light rounded-pill px-3" onclick='filterShop("shop3",this)'>Shop 3</button>
</div>
</div>
<div class=content-area id=stockContainer>
<div class=skeleton></div><div class=skeleton></div><div class=skeleton></div>
</div>
</div>
<script>const API_URL="https://script.google.com/macros/s/AKfycbz1Z3SYTDKmp7vibEZln8daR3hqz8xJNENa8gKmJWe5nwcnA9HMdncJIeG2yqDoj8Zx/exec";let GLOBAL_DATA={Inventory:[],Staff_Users:[],Logs:[]},CURRENT_USER=null,SHOP_FILTER="all",LAST_FETCH_JSON="",SYNC_INTERVAL=null;function loadCachedData(){const t=localStorage.getItem("lucky_cached_data");if(t)try{GLOBAL_DATA=JSON.parse(t),console.log("Loaded from Cache (Offline Mode)")}catch(t){console.error("Cache Error",t)}}function logout(){localStorage.removeItem("lucky_staff_user"),clearInterval(SYNC_INTERVAL),location.reload()}function enterApp(){document.getElementById("login-screen").style.display="none",document.getElementById("app-screen").style.display="flex",document.getElementById("displayUser").innerText=CURRENT_USER,renderStock(),fetchLatestData(!0,!1),SYNC_INTERVAL=setInterval((()=>{"searchInput"!==document.activeElement.id&&fetchLatestData(!0,!0)}),5e3)}async function fetchLatestData(t=!1,e=!1){const n=document.getElementById("connStatus");!e&&t&&0===GLOBAL_DATA.Inventory.length&&(document.getElementById("stockContainer").innerHTML='<div class="skeleton"></div><div class="skeleton"></div>');try{e||(n.className="status-dot");const o=await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"GET_ALL_DATA"})}),s=await o.json();if("success"===s.status){n.className="status-dot status-online";const e=JSON.stringify(s.data);e!==LAST_FETCH_JSON&&(GLOBAL_DATA=s.data,LAST_FETCH_JSON=e,localStorage.setItem("lucky_cached_data",e),GLOBAL_DATA.Inventory||(GLOBAL_DATA.Inventory=[]),GLOBAL_DATA.Logs||(GLOBAL_DATA.Logs=[]),t&&renderStock())}}catch(t){console.error("Sync Error",t),n.className="status-dot status-offline"}}function renderStock(){const t=document.getElementById("stockContainer"),e=document.getElementById("searchInput").value.toLowerCase();if(!GLOBAL_DATA.Inventory||0===GLOBAL_DATA.Inventory.length)return void(t.innerHTML='<div class="text-center mt-5 text-muted">No Data Available.<br>Offline or Empty.</div>');const n=GLOBAL_DATA.Inventory.filter((t=>{const n=(t.name?t.name.toString().toLowerCase():"").includes(e),o="all"===SHOP_FILTER||t.shop===SHOP_FILTER;return n&&o&&t.qty>0}));t.innerHTML="",0!==n.length?n.forEach(((e,n)=>{const o=document.createElement("div");o.className="stock-card",o.style.transitionDelay=(n<10?30*n:0)+"ms";let s="shop1"===e.shop?"bg-shop1":"shop2"===e.shop?"bg-shop2":"bg-shop3",a="shop1"===e.shop?"Main Branch":"shop2"===e.shop?"Shop 2":"Shop 3";o.innerHTML=`\n                <div class="d-flex justify-content-between align-items-start mb-2">\n                    <span class="shop-badge ${s}">${a}</span>\n                    <span class="fw-bold text-dark">Qty: ${e.qty}</span>\n                </div>\n                <h6 class="fw-bold text-dark mb-1">${e.name}</h6>\n                <div class="text-success fw-bold mb-3">â‚¹${e.sp||e.price||0}</div>\n                <div class="action-btns">\n                    <button class="btn-act btn-transfer" onclick="handleTransfer(${e.id})"><i class="fas fa-exchange-alt"></i> Transfer</button>\n                    <button class="btn-act btn-sell" onclick="handleSell(${e.id})"><i class="fas fa-shopping-cart"></i> Sell</button>\n                </div>\n            `,t.appendChild(o),setTimeout((()=>o.classList.add("visible")),50)})):t.innerHTML='<div class="text-center mt-5 text-muted">No Item Found</div>'}function filterStock(){renderStock()}function filterShop(t,e){SHOP_FILTER=t,document.querySelectorAll(".app-header button").forEach((t=>{t.classList.remove("btn-light","active-filter"),t.classList.add("btn-outline-light")})),e.classList.remove("btn-outline-light"),e.classList.add("btn-light"),renderStock()}function handleSell(t){const e=GLOBAL_DATA.Inventory.find((e=>e.id==t));Swal.fire({title:"Confirm Sale",text:`Sell 1 unit of ${e.name}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Sold",confirmButtonColor:"#15803d"}).then((t=>{t.isConfirmed&&processTransaction("SELL",e)}))}function handleTransfer(t){const e=GLOBAL_DATA.Inventory.find((e=>e.id==t));Swal.fire({title:"Transfer Stock",html:`Move <b>${e.name}</b> from ${e.shop} to:`,input:"select",inputOptions:{shop1:"Main Branch",shop2:"Shop 2",shop3:"Shop 3"},showCancelButton:!0,confirmButtonText:"Transfer",confirmButtonColor:"#c2410c"}).then((t=>{t.isConfirmed&&t.value!==e.shop?processTransaction("TRANSFER",e,t.value):t.value===e.shop&&Swal.fire("Error","Cannot transfer to same shop","warning")}))}async function processTransaction(t,e,n=null){Swal.fire({title:"Processing...",didOpen:()=>Swal.showLoading()}),await fetchLatestData(!1,!1);const o=GLOBAL_DATA.Inventory.find((t=>t.id==e.id));if(!o||o.qty<1)return Swal.fire("Error","Stock unavailable or changed recently.","error");const s=(new Date).toLocaleString(),a=o.sp||o.price||0;if("SELL"===t)o.qty=parseInt(o.qty)-1,GLOBAL_DATA.Logs.push({date:s,staff:CURRENT_USER,action:"SALE",details:`${o.name} sold from ${o.shop}`,amount:a});else if("TRANSFER"===t){o.qty=parseInt(o.qty)-1;let t=GLOBAL_DATA.Inventory.find((t=>t.name===o.name&&t.shop===n));if(t)t.qty=parseInt(t.qty)+1;else{let t=JSON.parse(JSON.stringify(o));t.id=Date.now(),t.shop=n,t.qty=1,GLOBAL_DATA.Inventory.push(t)}GLOBAL_DATA.Logs.push({date:s,staff:CURRENT_USER,action:"TRANSFER",details:`${o.name}: ${o.shop} -> ${n}`,amount:0})}const r={action:"SYNC_DATA",data:{Inventory:GLOBAL_DATA.Inventory,Logs:GLOBAL_DATA.Logs}};try{const t=await fetch(API_URL,{method:"POST",body:JSON.stringify(r)}),e=await t.json();if("success"!==e.status)throw new Error(e.message);Swal.fire("Success","Transaction Saved","success"),renderStock()}catch(t){Swal.fire("Error","Sync Failed: "+t.message,"error")}}window.onload=()=>{const t=localStorage.getItem("lucky_staff_user");loadCachedData(),t&&(CURRENT_USER=t,enterApp())},document.getElementById("loginForm").addEventListener("submit",(async t=>{t.preventDefault();const e=document.getElementById("loginId").value.trim(),n=document.getElementById("loginPass").value.trim(),o=document.querySelector(".btn-login");o.innerHTML='<i class="fas fa-spinner fa-spin"></i> Checking...';try{await fetchLatestData(!1,!1);const t=(GLOBAL_DATA.Staff_Users||[]).find((t=>String(t.username).trim().toLowerCase()===e.toLowerCase()&&String(t.password).trim()===n));t?(CURRENT_USER=t.username,localStorage.setItem("lucky_staff_user",CURRENT_USER),enterApp()):Swal.fire("Login Failed","Incorrect Username or Password.","error")}catch(t){Swal.fire("Network Error","Check internet connection.","error")}finally{o.innerHTML='ENTER SHOP <i class="fas fa-arrow-right"></i>'}}))</script>
</body>
</html>
